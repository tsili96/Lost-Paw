@using System.Security.Claims;
@model IEnumerable<LostPaw.Models.ChatViewModel>

@{
    ViewData["Title"] = "Chats";
}

<h2 class="mb-4">Your Chats</h2>

@if (!Model.Any())
{
    <p>No active chats found.</p>
}
else
{
    <div class="chat-list">
        @foreach (var chat in Model)
        {
            var chatPartner = chat.User1.Id == User.FindFirstValue(ClaimTypes.NameIdentifier) ? chat.User2 : chat.User1;

            <div class="chat-item border rounded p-3 mb-2 shadow-sm">
                <a href="@Url.Action("OpenChat", "Chat", new { chatId = chat.ChatId })" class="d-flex justify-content-between align-items-center text-decoration-none text-dark">
                    <div>
                        <strong>@chatPartner.UserName</strong>
                        <p class="mb-0 text-muted">@chat.LastMessage?.Content</p>
                    </div>
                    @if (chat.UnreadMessagesCount > 0)
                    {
                        <span class="badge bg-danger">@chat.UnreadMessagesCount</span>
                    }
                </a>
            </div>
        }
    </div>
}
